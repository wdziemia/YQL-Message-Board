<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <author>Wojciech Dziemianczyk</author>
    <description>Yahoo Message Board</description>
    <sampleQuery>SELECT * FROM {table} WHERE symbol='GOOG';</sampleQuery>
  </meta>

<bindings>
  <select itemPath="" produces="XML">
  <urls>
  	<url>http://finance.yahoo.com/mb/{symbol}/</url>
  </urls>
  <inputs>
  	<key id='symbol' type='xs:string' paramType='variable' required="true" />
  </inputs>
  <execute>
    <![CDATA[
	function getMessages() {
		var messages = <messages></messages>;
		
		for each ( var tr in path) {
			var message = <message></message>;
			var published = <published></published>;
			try {
				var title = tr.td[0].p.a.text();
				var link = tr.td[0].p.a.@href.text();
				
				var cite_time = tr.td[0].cite.span.text();
				var cite_user = tr.td[0].cite.a.text()
				var cite_user_link = tr.td[0].cite.a.@href.text();
				
				published.appendChild(<time>{cite_time}</time>);
				published.appendChild(<user>{cite_user}</user>);
				published.appendChild(<user_link>{cite_user_link}</user_link>);
				
				message.appendChild(<title>{title}</title>);
				message.appendChild(<link>{link}</link>);
				message.appendChild({published});
				
				messages.appendChild(message);
			} catch (err) { }
		}
		
		response.object.appendChild( messages );
		return true;
	}
	    
	try {  
		var url = "http://finance.yahoo.com/mb/" + symbol;
	    	var query = y.rest( url );	
	    	var data = query.accept( "text/html" ).get().response;
	    
	    	var path = y.xpath(data, "//table/tbody[@class='mb-ajxp-list mb-sorted-by-la']/tr");
		var size = path.*.length();
		
	    	response.object = <result symbol= {symbol} size={size}></result>;
    		
    		if (size > 0){
    			getMessages();
    		}
    		
	} catch(err) {  
   		response.object = {'result':'failure', 'error': err};  
	} 
	
	  
]]></execute>
</select>
</bindings>
</table>
